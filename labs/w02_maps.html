<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>

<meta charset="utf-8" />
<meta name="generator" content="quarto-1.4.546" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />

<meta name="author" content="Gabriele Filomena" />

<title>Web Mapping and Geovisualisation – 4  Static Maps</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<!-- htmldependencies:E3FAD763 -->
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous" data-relocate-top="true"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css" />
</head>

<body>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn"
      data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" 
      aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation"
      onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <h1 class="quarto-secondary-nav-title no-breadcrumbs"></h1>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" 
        aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation"
        onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="/">
      Web Mapping and Geovisualisation
      </a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/GDSL-UL/wma"  title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="/Web-Mapping-and-Geovisualisation.pdf">
              <i class="bi bi-bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="/Web-Mapping-and-Geovisualisation.epub">
              <i class="bi bi-bi-journal pe-1"></i>
            Download ePub
            </a>
          </li>
      </ul>
    </div>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-1" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-1">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/general/structure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/general/overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/general/assess.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assessments</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/general/setUp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>1</span>  <span class='chapter-title'>1. Install Miniconda (and Python)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/labs/w01_introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>2</span>  <span class='chapter-title'>Static Maps</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/labs/w01_refresher.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>3</span>  <span class='chapter-title'>Python Refresher</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/labs/w02_maps.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class='chapter-number'>4</span>  <span class='chapter-title'>Static Maps</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/labs/w03_webArch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>5</span>  <span class='chapter-title'>Web Architectures and APIs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/labs/w04_dataArch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>6</span>  <span class='chapter-title'>Data Architectures and Tiles</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/labs/w05_interactive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>7</span>  <span class='chapter-title'>Interactive Maps</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" ></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <div id="quarto-toc-target"></div>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>  <span class="chapter-title">Static Maps</span></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Gabriele Filomena </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">Invalid Date</p>
    </div>
  </div>
  
    
  </div>
  


</header>

<nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#static-maps-in-python" id="toc-static-maps-in-python"><span class="header-section-number">5</span> 2. Static Maps in Python</a></li>
  <li><a href="#part-i-basic-maps" id="toc-part-i-basic-maps"><span class="header-section-number">6</span> Part I: Basic Maps</a>
  <ul>
  <li><a href="#plotting-points" id="toc-plotting-points"><span class="header-section-number">6.1</span> 2.1 Plotting Points</a>
  <ul>
  <li><a href="#adding-some-context-base-maps-with-contextily" id="toc-adding-some-context-base-maps-with-contextily"><span class="header-section-number">6.1.1</span> Adding some context: Base Maps with <code>Contextily</code></a></li>
  <li><a href="#parameters-specific-to-point-in-the-plot-method" id="toc-parameters-specific-to-point-in-the-plot-method"><span class="header-section-number">6.1.2</span> Parameters specific to <code>Point</code> in the <code>plot</code> method</a></li>
  </ul></li>
  <li><a href="#plotting-linestrings" id="toc-plotting-linestrings"><span class="header-section-number">6.2</span> 2.2 Plotting LineStrings</a>
  <ul>
  <li><a href="#parameters-specific-to-linestring" id="toc-parameters-specific-to-linestring"><span class="header-section-number">6.2.1</span> Parameters specific to <code>LineString</code>:</a></li>
  </ul></li>
  <li><a href="#plotting-polygons" id="toc-plotting-polygons"><span class="header-section-number">6.3</span> 2.3 Plotting Polygons</a>
  <ul>
  <li><a href="#parameter-specific-to-polygon" id="toc-parameter-specific-to-polygon"><span class="header-section-number">6.3.1</span> Parameter specific to <code>Polygon</code>:</a></li>
  </ul></li>
  <li><a href="#plotting-more-than-one-layer-together" id="toc-plotting-more-than-one-layer-together"><span class="header-section-number">6.4</span> 2.4 Plotting more than one layer together</a></li>
  <li><a href="#sub-plots" id="toc-sub-plots"><span class="header-section-number">6.5</span> 2.5 Sub-plots</a></li>
  </ul></li>
  <li><a href="#part-ii-choropleth-mapping" id="toc-part-ii-choropleth-mapping"><span class="header-section-number">7</span> Part II: Choropleth Mapping</a>
  <ul>
  <li><a href="#data" id="toc-data"><span class="header-section-number">7.1</span> Data</a></li>
  <li><a href="#choropleth-maps-for-numerical-variables" id="toc-choropleth-maps-for-numerical-variables"><span class="header-section-number">7.2</span> 2.6 Choropleth Maps for Numerical Variables</a>
  <ul>
  <li><a href="#varying-alpha-transparency-based-on-an-array" id="toc-varying-alpha-transparency-based-on-an-array"><span class="header-section-number">7.2.1</span> Varying alpha transparency based on an array</a></li>
  </ul></li>
  <li><a href="#choropleth-maps-for-categorical-variables" id="toc-choropleth-maps-for-categorical-variables"><span class="header-section-number">7.3</span> 2.7 Choropleth Maps for Categorical Variables</a></li>
  </ul></li>
  <li><a href="#part-iii-cartograms-using-sizes-for-showing-the-magitude-of-a-value" id="toc-part-iii-cartograms-using-sizes-for-showing-the-magitude-of-a-value"><span class="header-section-number">8</span> Part III Cartograms: Using sizes for showing the magitude of a value</a>
  <ul>
  <li><a href="#polygons" id="toc-polygons"><span class="header-section-number">8.1</span> 2.8 Polygons</a></li>
  <li><a href="#points" id="toc-points"><span class="header-section-number">8.2</span> 2.9 Points</a></li>
  <li><a href="#linestring" id="toc-linestring"><span class="header-section-number">8.3</span> 2.10 LineString</a></li>
  </ul></li>
  </ul>
</nav>
<section id="static-maps-in-python" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> 2. Static Maps in Python</h1>
</section>
<section id="part-i-basic-maps" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Part I: Basic Maps</h1>
<p>In this session, we will use the libraries <code>matplotlib</code> and <code>contextily</code> to plot the information represented into different <code>GeoDataFrames</code>. We will look into plotting <code>Point</code>, <code>LineString</code> and <code>Polygon</code> <code>GeoDataFrames</code>. Most of the plots here are rather ugly but, at this point, the goal is to get familiar with the parameters of the plot function and what can be done with them.</p>
<div id="ebcbf5ee" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb1"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> osmnx <span class="im">as</span> ox</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> contextily <span class="im">as</span> ctx</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code></pre></div>
</div>
<section id="plotting-points" class="level2" data-number="6.1">
<h2 data-number="6.1"><span class="header-section-number">6.1</span> 2.1 Plotting Points</h2>
<p>Load the data of terrorist attacks 1970-2020 and choose a country. Germany is used as a case study here but feel free to change the country. If you do so, also change the <code>crs</code> (see https://epsg.io).</p>
<div id="4a257491" class="cell" data-execution_count="2">
<div class="sourceCode" id="cb2"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>attacks <span class="op">=</span> pd.read_csv(<span class="st">&quot;data/GTD_2022.csv&quot;</span>, low_memory <span class="op">=</span> <span class="va">False</span>)</span></code></pre></div>
</div>
<p>Creating the <code>GeoDataFrame</code> from the <code>DataFrame</code></p>
<div id="968dbc94" class="cell" data-execution_count="3">
<div class="sourceCode" id="cb3"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>germany <span class="op">=</span> [<span class="st">&#39;West Germany (FRG)&#39;</span>, <span class="st">&#39;Germany&#39;</span>, <span class="st">&#39;East Germany (GDR)&#39;</span>] <span class="co"># Germany was split till 1989 in two entities</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> attacks[attacks.country_txt.isin(germany)].copy()</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Uncomment the lines below for other countries that haven&#39;t changed their denominations/boundaries between 1970 and today:</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># country = &#39;France&#39; </span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># df = attacks[attacks.country_txt == country].copy()#</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>wgs <span class="op">=</span> <span class="st">&#39;EPSG:4326&#39;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>germany_crs <span class="op">=</span> <span class="st">&#39;EPSG:4839&#39;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gpd.GeoDataFrame(df, geometry<span class="op">=</span>gpd.points_from_xy(df.longitude, df.latitude), crs <span class="op">=</span> wgs)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gdf[<span class="op">~</span>gdf.geometry.is_empty] <span class="co"># remove empty geometries</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>gdf.to_file(<span class="st">&quot;data/germany.shp&quot;</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gdf.to_crs(germany_crs)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\gfilo\AppData\Local\Temp\ipykernel_6968\3815068564.py:11: UserWarning:

Column names longer than 10 characters will be truncated when saved to ESRI Shapefile.
</code></pre>
</div>
</div>
<p>Basic plotting</p>
<div id="0e13d702" class="cell" data-execution_count="4">
<div class="sourceCode" id="cb5"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare the axis and coordinate</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>nr_rows <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>nr_cols <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(nr_cols, nr_rows, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>gdf.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">&#39;red&#39;</span>, markersize<span class="op">=</span><span class="dv">7</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-5-output-1.png" width="431" height="485" /></p>
</figure>
</div>
</div>
</div>
<section id="slightly-improving-the-plot" class="level4" data-number="6.1.0.1">
<h4 data-number="6.1.0.1"><span class="header-section-number">6.1.0.1</span> Slightly improving the plot</h4>
<div id="d0c1c286" class="cell" data-execution_count="5">
<div class="sourceCode" id="cb6"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># removing ticks</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_ticklabels([])</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>ax.yaxis.set_ticklabels([])</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>ax.tick_params(axis<span class="op">=</span> <span class="st">&#39;both&#39;</span>, which<span class="op">=</span> <span class="st">&#39;both&#39;</span>, length<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>title_parameters <span class="op">=</span> {<span class="st">&#39;fontsize&#39;</span>:<span class="st">&#39;16&#39;</span>, <span class="st">&#39;fontname&#39;</span>:<span class="st">&#39;Times New Roman&#39;</span>}</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&quot;Terroristic Attacks in Germany&quot;</span>, <span class="op">**</span>title_parameters)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>fig</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-6-output-1.png" width="351" height="486" /></p>
</figure>
</div>
</div>
</div>
</section>
<section id="adding-some-context-base-maps-with-contextily" class="level3" data-number="6.1.1">
<h3 data-number="6.1.1"><span class="header-section-number">6.1.1</span> Adding some context: Base Maps with <code>Contextily</code></h3>
<p>see providers and options here https://xyzservices.readthedocs.io/en/stable/introduction.html</p>
<div id="d71b5c06" class="cell" data-execution_count="6">
<div class="sourceCode" id="cb7"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>source <span class="op">=</span> ctx.providers.CartoDB.Positron</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax, crs<span class="op">=</span> gdf.crs.to_string(), source<span class="op">=</span> source)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># replot</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>fig</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-7-output-1.png" width="351" height="486" /></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
</section>
<section id="parameters-specific-to-point-in-the-plot-method" class="level3" data-number="6.1.2">
<h3 data-number="6.1.2"><span class="header-section-number">6.1.2</span> Parameters specific to <code>Point</code> in the <code>plot</code> method</h3>
<ul>
<li><code>markersize</code>: numerical value (for now)</li>
<li><code>marker</code>: see https://matplotlib.org/stable/api/markers_api.html</li>
</ul>
<section id="other-properties-shape-independent" class="level4" data-number="6.1.2.1">
<h4 data-number="6.1.2.1"><span class="header-section-number">6.1.2.1</span> Other properties, shape independent:</h4>
<ul>
<li><code>color</code>: https://matplotlib.org/3.1.0/gallery/color/named_colors.html</li>
<li><code>alpha</code>: regulates transparency of the shape: 0 to 1</li>
</ul>
<div id="74b0f8fe" class="cell" data-execution_count="7">
<div class="sourceCode" id="cb9"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first, let&#39;s make a function</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ax_ticks_off(ax):</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    ax.xaxis.set_ticklabels([])</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    ax.yaxis.set_ticklabels([])</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span> <span class="st">&#39;both&#39;</span>, which<span class="op">=</span> <span class="st">&#39;both&#39;</span>, length<span class="op">=</span><span class="dv">0</span>)</span></code></pre></div>
</div>
<div id="dcddcd23" class="cell" data-execution_count="8">
<div class="sourceCode" id="cb10"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare the axis and coordinate</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>gdf.plot(ax<span class="op">=</span>ax, markersize <span class="op">=</span> <span class="dv">15</span>, color <span class="op">=</span> <span class="st">&#39;blue&#39;</span>, marker <span class="op">=</span> <span class="st">&#39;*&#39;</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax, crs<span class="op">=</span> gdf.crs.to_string(), source<span class="op">=</span> source)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>ax_ticks_off(ax)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-9-output-1.png" width="351" height="463" /></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="plotting-linestrings" class="level2" data-number="6.2">
<h2 data-number="6.2"><span class="header-section-number">6.2</span> 2.2 Plotting LineStrings</h2>
<p>Let’s import railway tracks in the Western Balkans (Slovenia, Croatia, Bosnia &amp; Herzegovina, Montenegro, Serbia, Kosovo)</p>
<div id="04975552" class="cell" data-execution_count="9">
<div class="sourceCode" id="cb11"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>wb_crs <span class="op">=</span> <span class="st">&#39;EPSG:31277&#39;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>lines_gdf <span class="op">=</span> gpd.read_file(<span class="st">&quot;data\wb_railways.shp&quot;</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>lines_gdf.plot()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-10-output-1.png" width="552" height="442" /></p>
</figure>
</div>
</div>
</div>
<div id="15748fc3" class="cell" data-execution_count="10">
<div class="sourceCode" id="cb12"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare the plot</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>lines_gdf.plot(ax<span class="op">=</span>ax, linewidth <span class="op">=</span> <span class="fl">0.8</span>, color <span class="op">=</span> <span class="st">&#39;blue&#39;</span>, alpha <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax, crs<span class="op">=</span> lines_gdf.crs.to_string(), source <span class="op">=</span> ctx.providers.Esri.WorldGrayCanvas)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>ax_ticks_off(ax)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&quot;Railway infrastructure in the West Balkans&quot;</span>, <span class="op">**</span>title_parameters) <span class="co">#parameters as above</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>Text(0.5, 1.0, &#39;Railway infrastructure in the West Balkans&#39;)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-11-output-2.png" width="614" height="480" /></p>
</figure>
</div>
</div>
</div>
<p>One can also filter prior to plotting, based on the columns in the GeoDataFrame. First we download Serbia’s Boundary with <code>OSMNX</code>, more on that later on. Then we filter <code>lines_gdf</code> with a <code>within</code> operation.</p>
<div id="2a7a2ca7" class="cell" data-execution_count="11">
<div class="sourceCode" id="cb14"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>serbia <span class="op">=</span> ox.geocode_to_gdf(<span class="st">&#39;Serbia&#39;</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>serbia <span class="op">=</span> serbia.to_crs(wb_crs)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>serbia_lines <span class="op">=</span> lines_gdf[lines_gdf.geometry.within(serbia.iloc[<span class="dv">0</span>].geometry)].copy() <span class="co">#there&#39;s only one polygon in the gdf</span></span></code></pre></div>
</div>
<div id="73b215c3" class="cell" data-execution_count="12">
<div class="sourceCode" id="cb15"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare the plot</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>serbia_lines.plot(ax<span class="op">=</span>ax, linewidth <span class="op">=</span> <span class="fl">0.8</span>, color <span class="op">=</span> <span class="st">&#39;blue&#39;</span>, alpha <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax, crs<span class="op">=</span> lines_gdf.crs.to_string(), source <span class="op">=</span> ctx.providers.Esri.WorldGrayCanvas)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>ax_ticks_off(ax)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&quot;Railway infrastructure in Serbia and Kosovo&quot;</span>, <span class="op">**</span>title_parameters) <span class="co">#parameters as above</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>Text(0.5, 1.0, &#39;Railway infrastructure in Serbia and Kosovo&#39;)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-13-output-2.png" width="399" height="486" /></p>
</figure>
</div>
</div>
</div>
<section id="parameters-specific-to-linestring" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1"><span class="header-section-number">6.2.1</span> Parameters specific to <code>LineString</code>:</h3>
<ul>
<li><code>linewidth</code>: numerical value (for now).</li>
<li><code>capstyle</code>: controls how Matplotlib draws the corners where two different line segments meet. See https://matplotlib.org/stable/gallery/lines_bars_and_markers/capstyle.html</li>
<li><code>joinstyle</code>’: controls how Matplotlib draws the corners where two different line segments meet. https://matplotlib.org/stable/gallery/lines_bars_and_markers/joinstyle.html</li>
</ul>
<div id="085f8b94" class="cell" data-execution_count="13">
<div class="sourceCode" id="cb17"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare the plot</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>serbia_lines.plot(ax<span class="op">=</span>ax, linewidth <span class="op">=</span> <span class="fl">0.9</span>, color <span class="op">=</span> <span class="st">&#39;black&#39;</span>, alpha <span class="op">=</span> <span class="dv">1</span>, capstyle <span class="op">=</span> <span class="st">&#39;round&#39;</span>, joinstyle <span class="op">=</span> <span class="st">&#39;round&#39;</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off() <span class="co"># we don&#39;t need the ticks function</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&quot;Railway infrastructure in Serbia&quot;</span>, <span class="op">**</span>title_parameters) <span class="co">#parameters as above</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>Text(0.5, 1.0, &#39;Railway infrastructure in Serbia&#39;)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-14-output-2.png" width="534" height="781" /></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="plotting-polygons" class="level2" data-number="6.3">
<h2 data-number="6.3"><span class="header-section-number">6.3</span> 2.3 Plotting Polygons</h2>
<p>We are again using <code>OSMNX</code> to download data from <code>OpenStreetMap</code> automatically. In this case, we will get building footprints from the city of Algiers in Alageria.</p>
<section id="parameter-specific-to-polygon" class="level3" data-number="6.3.1">
<h3 data-number="6.3.1"><span class="header-section-number">6.3.1</span> Parameter specific to <code>Polygon</code>:</h3>
<ul>
<li><code>edgecolor</code>: the outline of the polygon, by default = <code>None</code> (often better).</li>
<li><code>linewidth</code>: the width of the outline of the polygon.</li>
</ul>
<div id="202f6f01" class="cell" data-execution_count="14">
<div class="sourceCode" id="cb19"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>algeria_crs <span class="op">=</span> <span class="st">&#39;EPSG:30729&#39;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>tags <span class="op">=</span> {<span class="st">&quot;building&quot;</span>: <span class="va">True</span>} <span class="co">#OSM tags</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>buildings <span class="op">=</span> ox.features_from_address(<span class="st">&quot;Algiers, Algeria&quot;</span>, tags <span class="op">=</span> tags, dist <span class="op">=</span> <span class="dv">2000</span>) </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>buildings <span class="op">=</span> buildings.reset_index()</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a> <span class="co"># sometimes building footprints are represented by Points, let&#39;s disregard them</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>buildings <span class="op">=</span> buildings[(buildings.geometry.geom_type <span class="op">==</span> <span class="st">&#39;Polygon&#39;</span>) <span class="op">|</span> (buildings.geometry.geom_type <span class="op">==</span> <span class="st">&#39;MultiPolygon&#39;</span>)]</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>buildings <span class="op">=</span> buildings.to_crs(algeria_crs)</span></code></pre></div>
</div>
<div id="78628abf" class="cell" data-execution_count="15">
<div class="sourceCode" id="cb20"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&quot;Buildings in Algiers&quot;</span>, <span class="op">**</span>title_parameters)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off() <span class="co"># we don&#39;t need the ticks function</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>buildings.plot(ax<span class="op">=</span>ax, color <span class="op">=</span> <span class="st">&#39;orange&#39;</span>, edgecolor <span class="op">=</span> <span class="st">&#39;black&#39;</span>, lw <span class="op">=</span> <span class="fl">0.2</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>source <span class="op">=</span> ctx.providers.CartoDB.PositronNoLabels</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax, crs<span class="op">=</span> buildings.crs.to_string(), source<span class="op">=</span> source)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-16-output-1.png" width="669" height="781" /></p>
</figure>
</div>
</div>
</div>
<p>For polygons, you can also plot just the boundaries of the geometries by:</p>
<div id="e37d2fa8" class="cell" data-execution_count="16">
<div class="sourceCode" id="cb21"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>buildings.boundary.plot(lw <span class="op">=</span> <span class="fl">0.5</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-17-output-1.png" width="394" height="442" /></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="plotting-more-than-one-layer-together" class="level2" data-number="6.4">
<h2 data-number="6.4"><span class="header-section-number">6.4</span> 2.4 Plotting more than one layer together</h2>
<p>Let’s also download roads for Algiers</p>
<div id="41e52535" class="cell" data-execution_count="17">
<div class="sourceCode" id="cb22"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>tags <span class="op">=</span> {<span class="st">&quot;highway&quot;</span>: <span class="va">True</span>} <span class="co">#OSM tags</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>roads <span class="op">=</span> ox.features_from_address(<span class="st">&quot;Algiers, Algeria&quot;</span>, tags <span class="op">=</span> tags, dist <span class="op">=</span> <span class="dv">2000</span>) </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>roads <span class="op">=</span> roads.reset_index()</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>roads <span class="op">=</span> roads.to_crs(algeria_crs)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a> <span class="co"># sometimes building footprints are represented by Points, let&#39;s disregard them</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>roads <span class="op">=</span> roads[roads.geometry.geom_type <span class="op">==</span> <span class="st">&#39;LineString&#39;</span>]</span></code></pre></div>
</div>
<p>And plot everything togehter. It’s important to keep in mind that the last layer is always rendered on top of the others. In other words, they may cover the previous ones.</p>
<p>However, you can prevent this by passing arguments to the parameter <code>zorder</code> in the <code>plot</code> method. The layer with the higher zorder value will be plotted on top.</p>
<div id="ec9bd6eb" class="cell" data-execution_count="18">
<div class="sourceCode" id="cb23"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&quot;Buildings and Roads in Algiers&quot;</span>, <span class="op">**</span>title_parameters)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off() <span class="co"># we don&#39;t need the ticks function</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># only roads within the extent of the buildings layer</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>roads[roads.geometry.within(buildings.unary_union.envelope)].plot(ax<span class="op">=</span>ax, color <span class="op">=</span> <span class="st">&#39;grey&#39;</span>, lw <span class="op">=</span> <span class="fl">0.5</span>) <span class="co">#linewidth can be also passed as lw </span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>buildings.plot(ax<span class="op">=</span>ax, color <span class="op">=</span> <span class="st">&#39;orange&#39;</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-19-output-1.png" width="669" height="781" /></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sub-plots" class="level2" data-number="6.5">
<h2 data-number="6.5"><span class="header-section-number">6.5</span> 2.5 Sub-plots</h2>
<p>To obtain multiple sub-plots, we manipulate the <code>nrows</code>, <code>ncols</code> parameters. We can use this approach to: * Plot the same layer with different properties.</p>
<div id="0aa5dfe1" class="cell" data-execution_count="19">
<div class="sourceCode" id="cb24"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">&#39;red&#39;</span>, <span class="st">&#39;blue&#39;</span>]</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n, ax <span class="kw">in</span> <span class="bu">enumerate</span>(axes):</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    gdf.plot(ax<span class="op">=</span>ax, markersize <span class="op">=</span> <span class="dv">4</span>, color <span class="op">=</span> colors[n])</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    ax.set_axis_off()</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    ctx.add_basemap(ax, crs<span class="op">=</span> gdf.crs.to_string(), source<span class="op">=</span> source)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-20-output-1.png" width="757" height="463" /></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Plot different layers.</li>
</ul>
<div id="cc641f56" class="cell" data-execution_count="20">
<div class="sourceCode" id="cb25"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>gdfs <span class="op">=</span> [buildings, roads]</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">&#39;orange&#39;</span>, <span class="st">&#39;grey&#39;</span>]</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>buildings.plot(ax<span class="op">=</span>axes[<span class="dv">0</span>], color <span class="op">=</span> <span class="st">&#39;orange&#39;</span>, edgecolor <span class="op">=</span> <span class="st">&#39;none&#39;</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>roads.plot(ax<span class="op">=</span>axes[<span class="dv">1</span>], color <span class="op">=</span> <span class="st">&#39;gray&#39;</span>, lw <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax <span class="kw">in</span> axes:</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    ax.set_axis_off()</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    ctx.add_basemap(ax, crs<span class="op">=</span> buildings.crs.to_string(), source <span class="op">=</span> source)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-21-output-1.png" width="763" height="404" /></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Analyse phenomena across different geographical areas. For example, terrorism in Germany and in the UK.</li>
</ul>
<div id="438073cb" class="cell" data-execution_count="21">
<div class="sourceCode" id="cb26"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let&#39;s prepare the gdf for the UK</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>df_uk <span class="op">=</span> attacks[attacks.country_txt <span class="op">==</span> <span class="st">&#39;United Kingdom&#39;</span>].copy()</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>uk_crs <span class="op">=</span> <span class="st">&#39;EPSG:27700&#39;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>gdf_uk <span class="op">=</span> gpd.GeoDataFrame(df_uk, geometry<span class="op">=</span>gpd.points_from_xy(df_uk.longitude, df_uk.latitude), crs <span class="op">=</span> wgs)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>gdf_uk <span class="op">=</span> gdf_uk.to_crs(uk_crs)</span></code></pre></div>
</div>
<div id="30b6f0aa" class="cell" data-execution_count="22">
<div class="sourceCode" id="cb27"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>gdfs <span class="op">=</span> [gdf, gdf_uk]</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n, ax <span class="kw">in</span> <span class="bu">enumerate</span>(axes):</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    gdf_tmp <span class="op">=</span> gdfs[n]</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    gdf_tmp.plot(ax<span class="op">=</span>ax, color <span class="op">=</span> <span class="st">&#39;orange&#39;</span>, markersize <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    ax.set_axis_off()</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    ctx.add_basemap(ax, crs<span class="op">=</span> gdf_tmp.crs.to_string(), source<span class="op">=</span> source)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-23-output-1.png" width="760" height="463" /></p>
</figure>
</div>
</div>
</div>
<div class="alert alert-success">
<p><strong>Exercise</strong>:</p>
<ul>
<li>Think about the plots above and how they could be improved.</li>
<li>Copy and paste the code and execute the functions playing with the different parameters.</li>
<li>Produce a neat map using the GeoDataFrames avaible in this notebook or the ones employed in the previous sessions, making use of the elements/parameters discussed here.</li>
<li>Try out different tiles for the basemap to familiarise yourself with what’s aveilable.</li>
</ul>
</div>
</section>
</section>
<section id="part-ii-choropleth-mapping" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Part II: Choropleth Mapping</h1>
<div id="b421f749" class="cell" data-execution_count="23">
<div class="sourceCode" id="cb28"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geoplot.crs <span class="im">as</span> gcrs</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geoplot <span class="im">as</span> gplt</span></code></pre></div>
</div>
<section id="data" class="level2" data-number="7.1">
<h2 data-number="7.1"><span class="header-section-number">7.1</span> Data</h2>
<p>For this second part of the tutorial, we will use some data at the municipality level for Serbia. The data contains information regarding poverty level, average income, population and tourism. The data is taken from https://data.stat.gov.rs/?caller=SDDB&amp;languageCode=en-US and can be associated to the polygons representing the administrative boundaries of the municipalities. These boundaries can be found here https://data.humdata.org/dataset/geoboundaries-admin-boundaries-for-serbia?force_layout=desktop. While most of the data refers to 2023, the admin boundaries file traces back to 2017. Thus, it may contain obsolete information (few changes may occur).</p>
<p>Later on, we will go back to the terrorism dataset.</p>
<div id="68a7d6ae" class="cell" data-execution_count="24">
<div class="sourceCode" id="cb29"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This will be different on your computer and will depend on where</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># you have downloaded the files</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>serbia_crs <span class="op">=</span> <span class="st">&#39;EPSG:31277&#39;</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>wgs <span class="op">=</span> <span class="st">&#39;EPSG:4326&#39;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>serbia_admin <span class="op">=</span> gpd.read_file(<span class="st">&#39;data/serbia_admin.shp&#39;</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>serbia_admin.set_index(<span class="st">&#39;townID&#39;</span>, inplace <span class="op">=</span> <span class="va">True</span>, drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>serbia_admin <span class="op">=</span> serbia_admin.to_crs(serbia_crs)</span></code></pre></div>
</div>
<p>Let’s plot the <code>GeoDataFrame</code> following the last session’s steps.</p>
<div id="18ccc630" class="cell" data-execution_count="25">
<div class="sourceCode" id="cb30"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>serbia_admin.plot(ax <span class="op">=</span> ax, color <span class="op">=</span> <span class="st">&#39;salmon&#39;</span>, linewidth <span class="op">=</span> <span class="fl">0.3</span>, edgecolor <span class="op">=</span> <span class="st">&#39;white&#39;</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>title_parameters <span class="op">=</span> {<span class="st">&#39;fontsize&#39;</span>:<span class="st">&#39;16&#39;</span>, <span class="st">&#39;fontname&#39;</span>:<span class="st">&#39;Times New Roman&#39;</span>}</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&quot;Serbian Municipalities&quot;</span>, <span class="op">**</span>title_parameters) <span class="co">#parameters as above</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>Text(0.5, 1.0, &#39;Serbian Municipalities&#39;)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-26-output-2.png" width="352" height="486" /></p>
</figure>
</div>
</div>
</div>
<p>The we load the data and merge it into the <code>GeoDataFrame</code>, before getting rid of municipalities that do not have a corresponding shape/record in the GeoDataFrame (probably the result of changes in the national subdivisions).</p>
<div id="7c6b70e8" class="cell" data-execution_count="26">
<div class="sourceCode" id="cb32"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">&quot;data/serbia_data.csv&quot;</span>) <span class="co">#some slavic characters </span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>data.drop(<span class="st">&#39;name_en&#39;</span>, axis <span class="op">=</span> <span class="dv">1</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>serbia_admin <span class="op">=</span> pd.merge(serbia_admin, data, left_on <span class="op">=</span> <span class="st">&quot;townID&quot;</span>, right_on <span class="op">=</span> <span class="st">&quot;id&quot;</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>serbia_admin <span class="op">=</span> serbia_admin[serbia_admin.<span class="bu">id</span>.notna()]</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>serbia_admin[<span class="st">&#39;id&#39;</span>] <span class="op">=</span> serbia_admin[<span class="st">&#39;id&#39;</span>].astype(<span class="st">&#39;int64&#39;</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>serbia_admin.head()</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co">#let&#39;s save the so-obtained gdf for later (encoding for dealing with slavic characters).</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>serbia_admin.to_file(<span class="st">&quot;data/serbia_data.shp&quot;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>)</span></code></pre></div>
</div>
<p>Creating a choropleth map is rather straightforward and can ben done by using few other parameters. Reflect on what you see and whether the map below is informative.</p>
<div id="dd7d5d1d" class="cell" data-execution_count="27">
<div class="sourceCode" id="cb33"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>serbia_admin.plot(ax <span class="op">=</span> ax, column <span class="op">=</span> <span class="st">&#39;gross&#39;</span>, linewidth <span class="op">=</span> <span class="fl">0.3</span>, cmap <span class="op">=</span> <span class="st">&#39;Greens&#39;</span>, legend <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>title_parameters <span class="op">=</span> {<span class="st">&#39;fontsize&#39;</span>:<span class="st">&#39;16&#39;</span>, <span class="st">&#39;fontname&#39;</span>:<span class="st">&#39;Times New Roman&#39;</span>}</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&quot;Serbian Municipalities&quot;</span>, <span class="op">**</span>title_parameters) <span class="co">#parameters as above</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>Text(0.5, 1.0, &#39;Serbian Municipalities&#39;)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-28-output-2.png" width="464" height="486" /></p>
</figure>
</div>
</div>
</div>
</section>
<section id="choropleth-maps-for-numerical-variables" class="level2" data-number="7.2">
<h2 data-number="7.2"><span class="header-section-number">7.2</span> 2.6 Choropleth Maps for Numerical Variables</h2>
<p>We are essentialy using the same approach emplyed for creating basic maps, the method <code>plot</code>, but we now need to pass arguments to some new parameters to specify which column is to be represented and how. As an optional argument, one can set legend to <code>True</code> and the resulting figure will include a color bar.</p>
<ul>
<li><code>column</code>: the name of the column representing the variable that we want to used to colour-code our shapes.</li>
<li><code>scheme</code>: the scheme used to color the shapes based on the variable values.</li>
<li><code>cmap</code>: the colormap used to show variation.</li>
</ul>
<section id="colormaps" class="level4" data-number="7.2.0.1">
<h4 data-number="7.2.0.1"><span class="header-section-number">7.2.0.1</span> Colormaps</h4>
<p>Built-in color maps can be found here https://matplotlib.org/stable/gallery/color/colormap_reference.html. However one can create new ones as follows from a list of colours:</p>
<div id="ee7baeca" class="cell" data-execution_count="28">
<div class="sourceCode" id="cb35"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> seaborn <span class="im">import</span> palplot</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.colors <span class="im">import</span> LinearSegmentedColormap</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [(<span class="fl">0.00</span>, <span class="fl">0.00</span>, <span class="fl">0.00</span>,<span class="dv">1</span>), (<span class="fl">0.248</span>, <span class="fl">0.0271</span>, <span class="fl">0.569</span>, <span class="dv">1</span>), (<span class="fl">0.0311</span>, <span class="fl">0.258</span>, <span class="fl">0.646</span>,<span class="dv">1</span>),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>            (<span class="fl">0.019</span>, <span class="fl">0.415</span>, <span class="fl">0.415</span>,<span class="dv">1</span>), (<span class="fl">0.025</span>, <span class="fl">0.538</span>, <span class="fl">0.269</span>,<span class="dv">1</span>), (<span class="fl">0.0315</span>, <span class="fl">0.658</span>, <span class="fl">0.103</span>,<span class="dv">1</span>),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>            (<span class="fl">0.331</span>, <span class="fl">0.761</span>, <span class="fl">0.036</span>,<span class="dv">1</span>),(<span class="fl">0.768</span>, <span class="fl">0.809</span>, <span class="fl">0.039</span>,<span class="dv">1</span>), (<span class="fl">0.989</span>, <span class="fl">0.862</span>, <span class="fl">0.772</span>,<span class="dv">1</span>),</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>            (<span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>)]</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>palplot(colors)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-29-output-1.png" width="763" height="98" /></p>
</figure>
</div>
</div>
</div>
<div id="cd52de7a" class="cell" data-execution_count="29">
<div class="sourceCode" id="cb36"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>kindlmann <span class="op">=</span> LinearSegmentedColormap.from_list(<span class="st">&#39;kindlmann&#39;</span>, colors)</span></code></pre></div>
</div>
<p>or from color names:</p>
<div id="87b3a4f1" class="cell" data-execution_count="30">
<div class="sourceCode" id="cb37"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">&quot;white&quot;</span>, <span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;red&quot;</span>]</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>palplot(colors)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-31-output-1.png" width="242" height="98" /></p>
</figure>
</div>
</div>
</div>
<p>Let’s try a new colormap and let’s also set a number of classes to divide the data in, through the parameter <code>k</code>.</p>
<div id="f6faa63d" class="cell" data-execution_count="31">
<div class="sourceCode" id="cb38"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>white_to_red <span class="op">=</span> LinearSegmentedColormap.from_list(<span class="st">&quot;name&quot;</span>, [<span class="st">&quot;yellow&quot;</span>,<span class="st">&quot;red&quot;</span>])</span></code></pre></div>
</div>
<div id="9364ac3f" class="cell" data-execution_count="32">
<div class="sourceCode" id="cb39"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>serbia_admin.plot(ax <span class="op">=</span> ax, column <span class="op">=</span> <span class="st">&#39;gross&#39;</span>, linewidth <span class="op">=</span> <span class="fl">0.3</span>, cmap <span class="op">=</span> kindlmann.<span class="bu">reversed</span>(), legend <span class="op">=</span> <span class="va">True</span>, k <span class="op">=</span> <span class="dv">8</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>title_parameters <span class="op">=</span> {<span class="st">&#39;fontsize&#39;</span>:<span class="st">&#39;16&#39;</span>, <span class="st">&#39;fontname&#39;</span>:<span class="st">&#39;Times New Roman&#39;</span>}</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&quot;Serbian Municipalities&quot;</span>, <span class="op">**</span>title_parameters) <span class="co">#parameters as above</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>Text(0.5, 1.0, &#39;Serbian Municipalities&#39;)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-33-output-2.png" width="464" height="486" /></p>
</figure>
</div>
</div>
</div>
<p>With <code>GeoPandas</code>, when you use the <code>plot</code> method with <code>legend=True</code> the type of legend that appears depends on the data being visualized:</p>
<ul>
<li>Continuous Data: For columns with continuous data (like population estimates, temperatures, etc.), a color bar is generated as the legend. This color bar represents a range of values with a gradient, indicating how data values correspond to colors on the map.</li>
<li>Categorical Data: For columns with categorical data (like country names, types of land use, etc.), if you specify <code>legend=True</code>, <code>GeoPandas</code> will try to create a legend that categorizes these distinct values with different colors. However, creating legends for categorical data is not as straightforward as with continuous data and might require additional handling for a clear and informative legend (see below).</li>
</ul>
</section>
<section id="scheme" class="level4" data-number="7.2.0.2">
<h4 data-number="7.2.0.2"><span class="header-section-number">7.2.0.2</span> Scheme</h4>
<p>It is important to keep in mind that choropleth maps strongly depend on the scheme that it is passed (or the dafult one) to classify the data in groups. The plot above only shows one municipality cooloured in dark blue.</p>
<p>Look at the following plots and how three different classifiers produce different results for the same data.</p>
<p>Refer to https://geopandas.org/en/stable/gallery/choropleths.html and https://geographicdata.science/book/notebooks/05_choropleth.html for further details</p>
<div id="343d430c" class="cell" data-execution_count="33">
<div class="sourceCode" id="cb41"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for plotting the map and the distribution of the value in bins  </span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mapclassify <span class="im">import</span> Quantiles, EqualInterval, FisherJenks</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_scheme(gdf, column, scheme, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>)):</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">&#39;&#39;&#39;</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Arguments</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co">    ---------</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co">    gdf: GeoDataFrame</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co">        The GeoDataFrame to plot</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co">    column: str</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co">        Variable name </span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="co">    scheme: str</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co">        Name of the classification scheme to use </span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="co">    figsize: Tuple</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="co">        [Optional. Default = (10, 6)] Size of the figure to be created.</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="co">    &#39;&#39;&#39;</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>    schemes <span class="op">=</span> {<span class="st">&#39;equal_interval&#39;</span>: EqualInterval, <span class="st">&#39;quantiles&#39;</span>: Quantiles, <span class="st">&#39;fisher_jenks&#39;</span>: FisherJenks} </span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>    classification <span class="op">=</span> schemes[scheme](gdf[column], k<span class="op">=</span><span class="dv">7</span>)</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>    fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>figsize)</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># KDE</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>    sns.kdeplot(gdf[column], fill<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">&#39;purple&#39;</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>    sns.rugplot(gdf[column], alpha<span class="op">=</span><span class="fl">0.5</span>, color<span class="op">=</span><span class="st">&#39;purple&#39;</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> cut <span class="kw">in</span> classification.bins:</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>        ax1.axvline(cut, color<span class="op">=</span><span class="st">&#39;blue&#39;</span>, linewidth<span class="op">=</span><span class="fl">0.75</span>)</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="st">&#39;Value distribution&#39;</span>)</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Map</span></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> gdf.plot(column<span class="op">=</span>column, scheme<span class="op">=</span>scheme, alpha<span class="op">=</span><span class="fl">0.75</span>, k<span class="op">=</span><span class="dv">7</span>, cmap<span class="op">=</span><span class="st">&#39;RdPu&#39;</span>, ax<span class="op">=</span>ax2, linewidth<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>    ax2.axis(<span class="st">&#39;equal&#39;</span>)</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>    ax2.set_axis_off()</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="st">&#39;Geographical distribution&#39;</span>)</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>    fig.suptitle(scheme, size<span class="op">=</span><span class="dv">25</span>)</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code></pre></div>
</div>
<ul>
<li><em>Equal intervals</em> splits the range of the distribution, the difference between the minimum and maximum value, into equally large segments and to assign a different color to each of them according to a palette that reflects the fact that values are ordered.</li>
<li>To obtain a more balanced classification, one can use the <em>Quantiles</em> scheme. This assigns the same amount of values to each bin: the entire series is laid out in order and break points are assigned in a way that leaves exactly the same amount of observations between each of them. This “observation-based” approach contrasts with the “value-based” method of equal intervals and, although it can obscure the magnitude of extreme values, it can be more informative in cases with skewed distributions.</li>
<li>Amongst many other, the <em>Fisher Jenks</em> dynamically minimises the sum of the absolute deviations around class medians. The Fisher-Jenks alorithm is guaranteed to produce an optimal classification for a prespecified number of classes.</li>
</ul>
<p>The only additional arguments to pass for producing a choropleth, therefore, are the actual variable we would like to classify and the number of segments we want to create, <code>k</code>. This is, in other words, the number of colors that will be plotted on the map so, although having several can give more detail, at some point the marginal value of an additional one is fairly limited, given the ability of teh human brain to tell any differences.</p>
<div id="bba29e0b" class="cell" data-execution_count="34">
<div class="sourceCode" id="cb42"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>schemes <span class="op">=</span> [<span class="st">&#39;equal_interval&#39;</span>, <span class="st">&#39;quantiles&#39;</span>, <span class="st">&#39;fisher_jenks&#39;</span>]</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> scheme <span class="kw">in</span> schemes:</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    plot_scheme(serbia_admin, <span class="st">&#39;gross&#39;</span>, scheme)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-35-output-1.png" width="812" height="561" /></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-35-output-2.png" width="812" height="561" /></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-35-output-3.png" width="812" height="561" /></p>
</figure>
</div>
</div>
</div>
<p>Also consider the <a href="https://en.wikipedia.org/wiki/Modifiable_areal_unit_problem">Modifiable Areal Unit Problem</a> and how the geographies of the administrative boundaries, in this case, may impact the visualisation.</p>
<p><img src=img/MAUP.jpg/ width = 70%></p>
<p>For example, the most populated area is a municipality in the north that corresponds to the city of Novi Sad. Let’s have a look at the data</p>
<div id="edada0f4" class="cell" data-execution_count="35">
<div class="sourceCode" id="cb43"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>serbia_admin[[<span class="st">&#39;name&#39;</span>, <span class="st">&#39;pop&#39;</span>, <span class="st">&#39;Province&#39;</span>]].sort_values(by <span class="op">=</span> <span class="st">&#39;pop&#39;</span>, ascending <span class="op">=</span> <span class="va">False</span>).iloc[:<span class="dv">10</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">pop</th>
<th data-quarto-table-cell-role="th">Province</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">48</td>
<td>Novi Sad</td>
<td>341625.0</td>
<td>Južno-Bački</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">24</td>
<td>Novi Beograd</td>
<td>186667.0</td>
<td>Grad Beograd</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19</td>
<td>Čukarica</td>
<td>154854.0</td>
<td>Grad Beograd</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Kragujevac</td>
<td>154290.0</td>
<td>Šumadijski</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>Palilula</td>
<td>148292.0</td>
<td>Grad Beograd</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">34</td>
<td>Zemun</td>
<td>143173.0</td>
<td>Grad Beograd</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>Voždovac</td>
<td>137315.0</td>
<td>Grad Beograd</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>Zvezdara</td>
<td>130225.0</td>
<td>Grad Beograd</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">39</td>
<td>Leskovac</td>
<td>123201.0</td>
<td>Jablanički</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">120</td>
<td>Subotica</td>
<td>121250.0</td>
<td>Severno-Bački</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>In our dataset, the city of Novi Sad is categorised as a municipality by itself, because the administrative boundaries file is not updated. In reality, “since 2002, when the new statute of the city of Novi Sad came into effect, Novi Sad is divided into two city municipalities, Petrovaradin and Novi Sad. From 1989 until 2002, the name Municipality of Novi Sad meant the whole territory of the present-day city of Novi Sad.” (see: https://en.wikipedia.org/wiki/City_municipality_of_Novi_Sad).</p>
<p>On the contrary, Grad Beograd, that is Belgrade, is correctly split into different municipalities and its popoulation, when visualised, is spread out across the different geometries of its municipalities, In other words, our map depends on the geometries of the areas and on how the data was collected. While it could be that these areas were indeed identified by population size in the first place, the point is that the fact that Novi Sad is not split into more areas, as Belgrade is, makes it stound out more clearly from the map (and to some extent a bit unfairly)</p>
<p>This may happen with different types of data, particularly with administrative boundaries and it is crucial to reflect on how Choropleth maps may be impacted. One can look for more granular data or consider to weight the continous value with the texent of the are (i.e. obtaining density values).</p>
</section>
<section id="an-alternative-to-scheme-colormap-normalisation" class="level4" data-number="7.2.0.3">
<h4 data-number="7.2.0.3"><span class="header-section-number">7.2.0.3</span> An alternative to scheme: ColorMap Normalisation</h4>
<p>The <code>mpl.colors.Normalize</code> function in <code>matplotlib</code> creates a normalization object, which adjusts data values into a range that is ideal for colour mapping in a colormap. This function is particularly beneficial in scenarios where precise control over the mapping of data values to colour representations is needed.</p>
<p>When employed in a plotting function, this normalization object ensures that the data values are scaled to fit a pre-defined range (for instance, <code>norm = mpl.colors.Normalize(vmin=0, vmax=40)</code>). Any values falling below 0 are mapped to the lowest colour on the colormap scale, while values exceeding 40 are mapped to the highest colour. This approach is especially useful when aiming to highlight differences within a specific data range; it can significantly enhance the visualization of data, by, for example, emphasizing temperature variations between 0°C and 40°C. This becomes crucial in instances where a few data points with high values (e.g., 50°C) might otherwise lead to a less informative visualization if not ‘normalized’ and treated as if they corresponded to 40° C values.</p>
<p>For our dataset, we can use as <code>vmax</code> the value corresponding to the 90th percentle.</p>
<div id="6ae89c89" class="cell" data-execution_count="36">
<div class="sourceCode" id="cb44"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>serbia_admin[<span class="st">&#39;pop&#39;</span>].quantile(<span class="fl">0.90</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>93014.0</code></pre>
</div>
</div>
<div id="925535a8" class="cell" data-execution_count="37">
<div class="sourceCode" id="cb46"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>vmin <span class="op">=</span> serbia_admin[<span class="st">&#39;pop&#39;</span>].<span class="bu">min</span>()</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>vmax <span class="op">=</span> serbia_admin[<span class="st">&#39;pop&#39;</span>].quantile(<span class="fl">0.90</span>) <span class="co"># </span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>norm <span class="op">=</span> mpl.colors.Normalize(vmin<span class="op">=</span>vmin, vmax<span class="op">=</span>vmax)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>serbia_admin.plot(ax <span class="op">=</span> ax, column<span class="op">=</span><span class="st">&#39;pop&#39;</span>, cmap<span class="op">=</span><span class="st">&#39;OrRd&#39;</span>, legend<span class="op">=</span><span class="va">True</span>, norm <span class="op">=</span> norm)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-38-output-1.png" width="423" height="442" /></p>
</figure>
</div>
</div>
</div>
<div class="alert alert-info" style="font-size:120%">

<p><strong>Important</strong>: <br></p>
<p>When passing <code>norm</code> in the <code>plot</code> method, do not pass the arguments to the <code>scheme</code> parameter. For continuous variables, <code>norm</code> maps each value directly to a color, making discrete categorization redundant. In other words, it allows for a direct mapping of data values to the color map, eliminating the need for intermediary classification schemes.<code>norm</code> ensures a smooth gradient in the color map without artificially segmenting the data.</p>
</section>
<section id="customising-the-colorbar" class="level4" data-number="7.2.0.4">
<h4 data-number="7.2.0.4"><span class="header-section-number">7.2.0.4</span> Customising the colorbar</h4>
<div id="8c363a3e" class="cell" data-execution_count="38">
<div class="sourceCode" id="cb47"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.cm <span class="im">as</span> cm</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>cmap <span class="op">=</span> <span class="st">&#39;YlOrRd&#39;</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co"># we leave the legend out</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>serbia_admin.plot(column<span class="op">=</span><span class="st">&#39;pop&#39;</span>, cmap<span class="op">=</span>cmap, norm <span class="op">=</span> norm, ax<span class="op">=</span>ax)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co"># we add the colorbar separately passing the norm and cmap</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> fig.colorbar(cm.ScalarMappable(norm<span class="op">=</span>norm, cmap<span class="op">=</span>cmap), ax <span class="op">=</span> ax)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>cbar.outline.set_visible(<span class="va">False</span>)</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="co"># updating ticks VALUES</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>ticks <span class="op">=</span> [norm.vmin, norm.vmax]</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>cbar.set_ticks(ticks <span class="op">=</span> ticks)</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="co"># updating ticks LABELS</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>cbar.ax.set_yticklabels([<span class="bu">round</span>(t,<span class="dv">1</span>) <span class="cf">for</span> t <span class="kw">in</span> ticks])</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>cbar.ax.set_yticklabels([<span class="bu">round</span>(t,<span class="dv">1</span>) <span class="cf">if</span> t <span class="op">&lt;</span> norm.vmax <span class="cf">else</span> <span class="st">&quot;&gt;= &quot;</span><span class="op">+</span><span class="bu">str</span>(<span class="bu">round</span>(t,<span class="dv">1</span>)) <span class="cf">for</span> t <span class="kw">in</span> cbar.ax.get_yticks()])</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-39-output-1.png" width="463" height="442" /></p>
</figure>
</div>
</div>
</div>
<p>Above, we removed the outline of the color bar. Then we set the tick values to the min and the max population values, based on our norm object. Then, for the vmax value’s label we added a “&gt;=” to remind us that other, higher values are displayed with the darkest color.</p>
</section>
<section id="varying-alpha-transparency-based-on-an-array" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1"><span class="header-section-number">7.2.1</span> Varying alpha transparency based on an array</h3>
<p>Finally, we can also convey variation in a continuos scale through transparency. <code>alpha</code> doesn’t expect column names, so we cannot just pass the name of the column containing the variable. Instead we have to create an array from 0.0 to 1.0 values. To so we can a) use normalisation methods, or b) rescale the original values within 0 to 1 based on the original min and max values.</p>
<p>For example, with square root normalization:</p>
<div id="dd48ebfd" class="cell" data-execution_count="39">
<div class="sourceCode" id="cb48"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Create an alpha array based on a normalized value (e.g., population)</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>pop_max <span class="op">=</span> serbia_admin[<span class="st">&#39;pop&#39;</span>].<span class="bu">max</span>()</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> np.sqrt(serbia_admin[<span class="st">&#39;pop&#39;</span>] <span class="op">/</span> pop_max) </span></code></pre></div>
</div>
<div id="6d0ff661" class="cell" data-execution_count="40">
<div class="sourceCode" id="cb49"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with varying alpha values</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>serbia_admin.plot(color <span class="op">=</span> <span class="st">&#39;blue&#39;</span>, ax<span class="op">=</span>axes[<span class="dv">0</span>], alpha<span class="op">=</span>alpha, edgecolor<span class="op">=</span><span class="st">&#39;black&#39;</span>, linewidth <span class="op">=</span> <span class="fl">0.3</span>) <span class="co">#one color</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>serbia_admin.plot(cmap <span class="op">=</span> <span class="st">&#39;YlOrRd&#39;</span>, ax<span class="op">=</span>axes[<span class="dv">1</span>], alpha<span class="op">=</span>alpha, edgecolor<span class="op">=</span><span class="st">&#39;red&#39;</span>, linewidth <span class="op">=</span> <span class="fl">0.3</span>) <span class="co">#cmap</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax <span class="kw">in</span> axes:</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>    ax.set_axis_off()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-41-output-1.png" width="758" height="463" /></p>
</figure>
</div>
</div>
</div>
<div class="alert alert-info" style="font-size:120%">

<p><strong>Important</strong>: <br></p>
<p><code>matplotlib</code> would not able to plot a color bar from variations in the alpha value since no column is passed directly. We would need, in this case, to build a color bar manually as demonstrated above.</p>
</section>
</section>
<section id="choropleth-maps-for-categorical-variables" class="level2" data-number="7.3">
<h2 data-number="7.3"><span class="header-section-number">7.3</span> 2.7 Choropleth Maps for Categorical Variables</h2>
<p>A choropleth for categorical variables assigns a different color to every potential value in the series based on certain colormaps (<code>cmap</code>). We don’t need to specify a scheme in this case, but just to the categorical <code>column</code>. Using last’s week GeoDataFrame, we can plot terrorist attacks in Germany, for example, by group.</p>
<div id="51c0c364" class="cell" data-execution_count="41">
<div class="sourceCode" id="cb50"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gpd.read_file(<span class="st">&quot;data/germany.shp&quot;</span>).to_crs(germany_crs)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>gdf.plot(ax <span class="op">=</span> ax, column <span class="op">=</span> <span class="st">&#39;gname&#39;</span>, legend <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>title_parameters <span class="op">=</span> {<span class="st">&#39;fontsize&#39;</span>:<span class="st">&#39;16&#39;</span>, <span class="st">&#39;fontname&#39;</span>:<span class="st">&#39;Times New Roman&#39;</span>}</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&quot;Terrorist Attacks in Germany, by Group&quot;</span>, <span class="op">**</span>title_parameters) <span class="co">#parameters as above</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>Text(0.5, 1.0, &#39;Terrorist Attacks in Germany, by Group&#39;)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-42-output-2.png" width="514" height="2846" /></p>
</figure>
</div>
</div>
</div>
<p>The map above is what you would get from datasets that are not cleaned/manipulated directly or when there are too many categories in the selected column. First, let’s get a slimmer slice of the gdf that only contains attacks that cause a number of fatalies and wounded higher than 10.</p>
<div id="3818c63e" class="cell" data-execution_count="42">
<div class="sourceCode" id="cb52"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>condition <span class="op">=</span> (gdf.nkill <span class="op">+</span> gdf.nwound) <span class="op">&gt;</span> <span class="dv">10</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>gdf_filtered <span class="op">=</span> gdf[condition].copy()</span></code></pre></div>
</div>
<p>Then, let’s build a function that creates a random color map based on the number of categories. This creates random <code>HUE</code>-based colors:</p>
<div id="a841a2b6" class="cell" data-execution_count="43">
<div class="sourceCode" id="cb53"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate random colormap</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rand_cmap(nlabels):</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot; </span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co">    It generates a categorical random color map, given the number of classes</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co">    nlabels: int</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="co">        The number of categories to be coloured.</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="co">    type_color: str {&quot;soft&quot;, &quot;bright&quot;} </span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="co">        It defines whether using bright or soft pastel colors, by limiting the RGB spectrum.</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="co">       </span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="co">    cmap: matplotlib.colors.LinearSegmentedColormap</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a><span class="co">        The color map.</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span>   </span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate color map for bright colors, based on hsv</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>    randHSVcolors <span class="op">=</span> [(np.random.uniform(low<span class="op">=</span><span class="fl">0.20</span>, high<span class="op">=</span><span class="fl">0.80</span>),</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>                          np.random.uniform(low<span class="op">=</span><span class="fl">0.20</span>, high<span class="op">=</span><span class="fl">0.80</span>),</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>                          np.random.uniform(low<span class="op">=</span><span class="fl">0.20</span>, high<span class="op">=</span> <span class="fl">0.80</span>)) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(nlabels)]</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>    random_colormap <span class="op">=</span> LinearSegmentedColormap.from_list(<span class="st">&#39;new_map&#39;</span>, randHSVcolors, N<span class="op">=</span>nlabels)</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> random_colormap </span></code></pre></div>
</div>
<div id="4837c00b" class="cell" data-execution_count="44">
<div class="sourceCode" id="cb54"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>cmap <span class="op">=</span> rand_cmap(<span class="bu">len</span>(gdf_filtered.gname.unique()))</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>cmap</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<div style="vertical-align: middle;"><strong>new_map</strong> </div><div class="cmap"><img alt="new_map colormap" title="new_map" style="border: 1px solid #555;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAABACAYAAABsv8+/AAAAFnRFWHRUaXRsZQBuZXdfbWFwIGNvbG9ybWFwk+4SdgAAABx0RVh0RGVzY3JpcHRpb24AbmV3X21hcCBjb2xvcm1hcDTAow8AAAAwdEVYdEF1dGhvcgBNYXRwbG90bGliIHYzLjguMiwgaHR0cHM6Ly9tYXRwbG90bGliLm9yZw8V3hIAAAAydEVYdFNvZnR3YXJlAE1hdHBsb3RsaWIgdjMuOC4yLCBodHRwczovL21hdHBsb3RsaWIub3JnIbNBNQAAAZ9JREFUeJzt1iFK2AEcQOG/Ggzrllk0OA/gAYwTxGDwBBarybboMYYHsNuEwVAsNgerBq0iaxvuGL/wvu8Cr76Vs4Ojj2XI34udke6vu4eR7ufd45Hu0freSPfn6/lId/36cqS79fX7SPftZm2ke/tte6R7+vt+pPv88m+k++N9Y6S7v/lnpPt89Wmk+3T4ZaR7cvc40l2WZVkdKwMAYwwAAAQZAAAIMgAAEGQAACDIAABAkAEAgCADAABBBgAAggwAAAQZAAAIMgAAEGQAACDIAABAkAEAgCADAABBBgAAggwAAAQZAAAIMgAAEGQAACDIAABAkAEAgCADAABBBgAAggwAAAQZAAAIMgAAEGQAACDIAABAkAEAgCADAABBBgAAggwAAAQZAAAIMgAAEGQAACDIAABAkAEAgCADAABBBgAAggwAAAQZAAAIMgAAEGQAACDIAABAkAEAgCADAABBBgAAggwAAAQZAAAIMgAAEGQAACDIAABAkAEAgCADAABBBgAAggwAAAQZAAAIMgAAEGQAACDIAABAkAEAgKD/KCsbuiZ0IkkAAAAASUVORK5CYII="></div><div style="vertical-align: middle; max-width: 514px; display: flex; justify-content: space-between;"><div style="float: left;"><div title="#6a494fff" style="display: inline-block; width: 1em; height: 1em; margin: 0; vertical-align: middle; border: 1px solid #555; background-color: #6a494fff;"></div> under</div><div style="margin: 0 auto; display: inline-block;">bad <div title="#00000000" style="display: inline-block; width: 1em; height: 1em; margin: 0; vertical-align: middle; border: 1px solid #555; background-color: #00000000;"></div></div><div style="float: right;">over <div title="#9b5053ff" style="display: inline-block; width: 1em; height: 1em; margin: 0; vertical-align: middle; border: 1px solid #555; background-color: #9b5053ff;"></div></div>
</div>
</div>
<p>We also place the legend on the center left. This is done automatically, but the legend and its items can be manipulated directly. Legends in <code>matplotlib</code> are extremely complex to personalise. However, do have a look at https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.legend.html#matplotlib.pyplot.legend for both automatic and explicit manipulation.</p>
<div id="7b5b691f" class="cell" data-execution_count="45">
<div class="sourceCode" id="cb55"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>legend_kwds<span class="op">=</span>{<span class="st">&quot;loc&quot;</span>: <span class="st">&quot;center left&quot;</span>, <span class="st">&quot;bbox_to_anchor&quot;</span>: (<span class="dv">1</span>, <span class="fl">0.5</span>)}</span></code></pre></div>
</div>
<div id="d7799903" class="cell" data-execution_count="46">
<div class="sourceCode" id="cb56"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>gdf_filtered.plot(ax <span class="op">=</span> ax, column <span class="op">=</span> <span class="st">&#39;gname&#39;</span>, legend <span class="op">=</span> <span class="va">True</span>, cmap <span class="op">=</span> cmap, legend_kwds <span class="op">=</span> legend_kwds)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>title_parameters <span class="op">=</span> {<span class="st">&#39;fontsize&#39;</span>:<span class="st">&#39;16&#39;</span>, <span class="st">&#39;fontname&#39;</span>:<span class="st">&#39;Times New Roman&#39;</span>}</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&quot;Terrorist Attacks in Germany, by Group&quot;</span>, <span class="op">**</span>title_parameters) <span class="co">#parameters as above</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax, crs<span class="op">=</span> gdf_filtered.crs.to_string(), source <span class="op">=</span> ctx.providers.Esri.WorldGrayCanvas)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-47-output-1.png" width="818" height="508" /></p>
</figure>
</div>
</div>
</div>
<p>We can also convey the impact of the events through the <code>markersize</code>. This introduces the concept of <em>cartogram</em> (see below).</p>
<div id="f5b7eb62" class="cell" data-execution_count="47">
<div class="sourceCode" id="cb57"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>gdf_filtered.plot(ax <span class="op">=</span> ax, column <span class="op">=</span> <span class="st">&#39;gname&#39;</span>, markersize <span class="op">=</span> <span class="st">&#39;nwound&#39;</span>, legend <span class="op">=</span> <span class="va">True</span>, cmap <span class="op">=</span> cmap, legend_kwds <span class="op">=</span> legend_kwds)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&quot;Terrorist Attacks in Germany, by Group&quot;</span>, <span class="op">**</span>title_parameters) <span class="co">#parameters as above</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax, crs<span class="op">=</span> gdf_filtered.crs.to_string(), source <span class="op">=</span> ctx.providers.Esri.WorldGrayCanvas)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-48-output-1.png" width="754" height="486" /></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="part-iii-cartograms-using-sizes-for-showing-the-magitude-of-a-value" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Part III Cartograms: Using sizes for showing the magitude of a value</h1>
<p><a href="https://www.data-to-viz.com/graph/cartogram.html">Cartograms</a> are maps that represent the spatial distribution of a variable not by encoding it in a color palette but rather by modifying geographical objects. There are many algorithms to distort the shapes of geographical entities according to values, some of them incredibly complicated and complex.</p>
<section id="polygons" class="level2" data-number="8.1">
<h2 data-number="8.1"><span class="header-section-number">8.1</span> 2.8 Polygons</h2>
<p>You can obtain cartograms for <code>Polygon</code> with <code>geoplot</code>: see https://residentmario.github.io/geoplot/</p>
<p><code>geoplot</code> functions pretty much work as <code>plot</code></p>
<div id="e6f0a3ee" class="cell" data-execution_count="48">
<div class="sourceCode" id="cb58"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this library needs the GeoDataFrame to be reverted to WGS</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> gplt.cartogram(serbia_admin.to_crs(wgs), scale<span class="op">=</span><span class="st">&#39;pop&#39;</span>, projection<span class="op">=</span>gcrs.Mercator(), color <span class="op">=</span> <span class="st">&#39;darkblue&#39;</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># see for projections that work with gplt https://scitools.org.uk/cartopy/docs/v0.15/crs/projections.html</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>gplt.polyplot(serbia_admin.to_crs(wgs), facecolor<span class="op">=</span><span class="st">&#39;lightgray&#39;</span>, edgecolor<span class="op">=</span><span class="st">&#39;white&#39;</span>, ax<span class="op">=</span>ax, lw <span class="op">=</span> <span class="fl">0.5</span>) <span class="co"># this is just for comparison</span></span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-49-output-1.png" width="355" height="463" /></p>
</figure>
</div>
</div>
</div>
</section>
<section id="points" class="level2" data-number="8.2">
<h2 data-number="8.2"><span class="header-section-number">8.2</span> 2.9 Points</h2>
<p>For <code>Point</code> GeoDataFrames we can just go back to <code>plot</code> and pass a column name to <code>markersize</code>.</p>
<div id="3f2dad70" class="cell" data-execution_count="49">
<div class="sourceCode" id="cb59"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>attacks <span class="op">=</span> pd.read_csv(<span class="st">&quot;data/GTD_2022.csv&quot;</span>, low_memory <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>country <span class="op">=</span> <span class="st">&#39;Germany&#39;</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> attacks[attacks.country_txt <span class="op">==</span> country].copy()</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>wgs <span class="op">=</span> <span class="st">&#39;EPSG:4326&#39;</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>germany_crs <span class="op">=</span> <span class="st">&#39;EPSG:4839&#39;</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gpd.GeoDataFrame(df, geometry<span class="op">=</span>gpd.points_from_xy(df.longitude, df.latitude), crs <span class="op">=</span> wgs)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gdf.to_crs(germany_crs)</span></code></pre></div>
</div>
<div id="e03f641d" class="cell" data-execution_count="50">
<div class="sourceCode" id="cb60"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>gdf.plot(ax <span class="op">=</span> ax, markersize <span class="op">=</span> <span class="st">&#39;nwound&#39;</span>, color <span class="op">=</span> <span class="st">&#39;purple&#39;</span>, legend <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-51-output-1.png" width="361" height="463" /></p>
</figure>
</div>
</div>
</div>
<p>One can also convert convert polygons into points by using their centroids, and then define the size of the dot proportionally to the value of the variable we want to display.</p>
</section>
<section id="linestring" class="level2" data-number="8.3">
<h2 data-number="8.3"><span class="header-section-number">8.3</span> 2.10 LineString</h2>
<p>For <code>LineString</code> we pass the column name to <code>linewidth</code>.</p>
<p>Let’s load a shapefile of lines. These lines represent frequnecy of train connections from/to train stations in the region of Liguria (Italy) to other stations within or outside the region. Each line refers to a connection between two specific stations, through a certain type of service and contains information about the frequency of that type of service. For example, the cities of Savona and Finale Ligure might be connected by 5 InterCity trains and 50 regional services. These services correspond to 2 different records.</p>
<div id="e5fee05b" class="cell" data-execution_count="51">
<div class="sourceCode" id="cb61"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>trains_freq <span class="op">=</span> gpd.read_file(<span class="st">&quot;data/trains_liguria.shp&quot;</span> )</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>trains_freq.crs</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>&lt;Projected CRS: EPSG:3003&gt;
Name: Monte Mario / Italy zone 1
Axis Info [cartesian]:
- X[east]: Easting (metre)
- Y[north]: Northing (metre)
Area of Use:
- name: Italy - onshore and offshore - west of 12°E.
- bounds: (5.93, 36.53, 12.0, 47.04)
Coordinate Operation:
- name: Italy zone 1
- method: Transverse Mercator
Datum: Monte Mario
- Ellipsoid: International 1924
- Prime Meridian: Greenwich</code></pre>
</div>
</div>
<p>Let’s check the type of services contained here.</p>
<div id="c71e1a26" class="cell" data-execution_count="52">
<div class="sourceCode" id="cb63"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>trains_freq[<span class="st">&#39;train_type&#39;</span>].unique()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>array([&#39;REG&#39;, &#39;IC&#39;, &#39;FB&#39;, &#39;ICN&#39;, &#39;U&#39;, &#39;EC/EN&#39;, &#39;AV&#39;], dtype=object)</code></pre>
</div>
</div>
<p>We have: - ‘REG’: regional trains. - ‘IC’: intercity trains. - ‘FB’: similar to IC, but slightly faster. - ‘ICN’: sleeper trains. - ‘U’: urban trains (Genoa). - ‘EC/EN’: international trains. - ‘AV’: High-speed trains.</p>
<p>Let’s keep just regional, intercity, and high-speed trains.</p>
<div id="91516976" class="cell" data-execution_count="53">
<div class="sourceCode" id="cb65"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>to_keep <span class="op">=</span> [<span class="st">&#39;REG&#39;</span>, <span class="st">&#39;IC&#39;</span>, <span class="st">&#39;AV&#39;</span>]</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>trains_freq <span class="op">=</span> trains_freq[trains_freq[<span class="st">&#39;train_type&#39;</span>].isin(to_keep)]</span></code></pre></div>
</div>
<p>The usage of <code>linewdith</code> is a bit different from <code>markersize</code> for some reason. We have to pass an <code>array</code> of N values, where N is equal to the GeoDataFrame size. In other words, we have to pass the column we want to use to regulate the line width direclty as a list/array. Specifying the column name is not enough.</p>
<div id="e2dd0947" class="cell" data-execution_count="54">
<div class="sourceCode" id="cb66"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">15</span>))</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>trains_freq.plot(ax <span class="op">=</span> ax, linewidth <span class="op">=</span> trains_freq[<span class="st">&#39;freq&#39;</span>])</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-55-output-1.png" width="763" height="664" /></p>
</figure>
</div>
</div>
</div>
<p>As you can see, the default arguments and simply passing the column values do not produce pretty results. The first thing to look at is the values that are passed to <code>linewidth</code>. In some cases the min and max values, as well as their distribution, are not ideal for visually conveying the magnitude of the variable attached to the geometry. One option is to use a multiplier factor (see below), or to rescale the values from 0 to 1, for example, and then, again, if necessary use a multiplier.</p>
<div id="83fef61e" class="cell" data-execution_count="55">
<div class="sourceCode" id="cb67"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">20</span>))</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>lw <span class="op">=</span> trains_freq[<span class="st">&#39;freq&#39;</span>] <span class="op">*</span> <span class="fl">0.15</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>trains_freq.plot(ax <span class="op">=</span> ax, linewidth <span class="op">=</span> lw, capstyle <span class="op">=</span> <span class="st">&#39;round&#39;</span>, joinstyle <span class="op">=</span> <span class="st">&#39;round&#39;</span>, column <span class="op">=</span> <span class="st">&#39;train_type&#39;</span>, legend <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax, crs<span class="op">=</span> trains_freq.crs.to_string(), source <span class="op">=</span> ctx.providers.Esri.WorldGrayCanvas)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img src="w02_maps_files/figure-html/cell-56-output-1.png" width="1135" height="986" /></p>
</figure>
</div>
</div>
</div>
<p>While this looks a bit better, this visualisation is not ideal because the frequencies are not snapped to the actual railway network. The lines represent instead connection between train stops and therefore their coordinatse only include the ones corresponding to the stations where the different services call at. Cne can devise approaches to: - Assigning the frequencies, or any other value, to the corresponding infrastructure’s section. For example, the railway section between two stations could be associated with a value representing the total number of REG services along it. - Smoothing the lines representing the services by adding further coordinates along the line.</p>
<p>Both these processes go beyond the scopes of this lab and require several considerations depending on the data, the scale, and what information one wants to displays.</p>
<div class="alert alert-success">
<p><strong>Exercise</strong>:</p>
<p>Today we’ve seen how to exploit matplotlib to plot GeoDataFrame. Go through the notebook again if you feel that there’s something you need to review. You are not expected to remember each step/method/parameter. Rather, this notebook should be used as a reference from producing maps in python. Do keep in mind that most of the maps above have been produced with just a bunch of rows, so each of them can be improved and embellished with some more effort.</p>
<p>Now, if you are not overwhelmed, have a look at the very last map and produce some nice visualisation using the same data. You can further improve it clarity, add a legend that refers to the line width, visualise only a certain type of service, or add information/context, for example. In the folder ‘’ you can also find a shapefile containing all the train stations in Italy, should you need that.</p>
</div>
<section id="saving-figures-check-here-for-details" class="level4" data-number="8.3.0.1">
<h4 data-number="8.3.0.1"><span class="header-section-number">8.3.0.1</span> Saving figures (check <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.savefig.html">here for details</a>)</h4>
<div id="4518c7f1" class="cell" data-execution_count="56">
<div class="sourceCode" id="cb68"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>fig.savefig(<span class="st">&quot;fig1.pdf&quot;</span>, dpi<span class="op">=</span><span class="st">&#39;figure&#39;</span>, <span class="bu">format</span><span class="op">=</span><span class="st">&quot;pdf&quot;</span>, bbox_inches <span class="op">=</span> <span class="st">&#39;tight&#39;</span>)</span></code></pre></div>
</div>
<div id="quarto-navigation-envelope" class="hidden">
<p><span class="hidden" data-render-id="quarto-int-sidebar-title">Web Mapping and Geovisualisation</span> <span class="hidden" data-render-id="quarto-int-navbar-title">Web Mapping and Geovisualisation</span> <span class="hidden" data-render-id="quarto-int-next"><span class="chapter-number">5</span>  <span class="chapter-title">Web Architectures and APIs</span></span> <span class="hidden" data-render-id="quarto-int-prev"><span class="chapter-number">3</span>  <span class="chapter-title">Python Refresher</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/index.htmlWelcome">Welcome</span> <span class="hidden" data-render-id="quarto-int-sidebar:/general/structure.htmlSyllabus">Syllabus</span> <span class="hidden" data-render-id="quarto-int-sidebar:/general/overview.htmlOverview">Overview</span> <span class="hidden" data-render-id="quarto-int-sidebar:/general/assess.htmlAssessments">Assessments</span> <span class="hidden" data-render-id="quarto-int-sidebar:/general/setUp.html&lt;span-class=&#39;chapter-number&#39;&gt;1&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;1.-Install-Miniconda-(and-Python)&lt;/span&gt;"><span class="chapter-number">1</span>  <span class="chapter-title">1. Install Miniconda (and Python)</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/labs/w01_introduction.html&lt;span-class=&#39;chapter-number&#39;&gt;2&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Static-Maps&lt;/span&gt;"><span class="chapter-number">2</span>  <span class="chapter-title">Static Maps</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/labs/w01_refresher.html&lt;span-class=&#39;chapter-number&#39;&gt;3&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Python-Refresher&lt;/span&gt;"><span class="chapter-number">3</span>  <span class="chapter-title">Python Refresher</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/labs/w02_maps.html&lt;span-class=&#39;chapter-number&#39;&gt;4&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Static-Maps&lt;/span&gt;"><span class="chapter-number">4</span>  <span class="chapter-title">Static Maps</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/labs/w03_webArch.html&lt;span-class=&#39;chapter-number&#39;&gt;5&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Web-Architectures-and-APIs&lt;/span&gt;"><span class="chapter-number">5</span>  <span class="chapter-title">Web Architectures and APIs</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/labs/w04_dataArch.html&lt;span-class=&#39;chapter-number&#39;&gt;6&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Data-Architectures-and-Tiles&lt;/span&gt;"><span class="chapter-number">6</span>  <span class="chapter-title">Data Architectures and Tiles</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/labs/w05_interactive.html&lt;span-class=&#39;chapter-number&#39;&gt;7&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Interactive-Maps&lt;/span&gt;"><span class="chapter-number">7</span>  <span class="chapter-title">Interactive Maps</span></span> <span class="hidden" data-render-id="quarto-breadcrumbs-&lt;span-class=&#39;chapter-number&#39;&gt;4&lt;/span&gt;--&lt;span-class=&#39;chapter-title&#39;&gt;Static-Maps&lt;/span&gt;"><span class="chapter-number">4</span>  <span class="chapter-title">Static Maps</span></span></p>
<div class="hidden" data-render-id="footer-left">
<p>Web Mapping and Geovisualisation by Gabriele Filomena and Elisabetta Pietrostefani.</p>
</div>
<div class="hidden" data-render-id="footer-right">
<p>This book was built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
</div>
<div id="quarto-meta-markdown" class="hidden">
<p><span class="hidden" data-render-id="quarto-metatitle">Web Mapping and Geovisualisation - <span class="chapter-number">4</span>  <span class="chapter-title">Static Maps</span></span> <span class="hidden" data-render-id="quarto-twittercardtitle">Web Mapping and Geovisualisation - <span class="chapter-number">4</span>  <span class="chapter-title">Static Maps</span></span> <span class="hidden" data-render-id="quarto-ogcardtitle">Web Mapping and Geovisualisation - <span class="chapter-number">4</span>  <span class="chapter-title">Static Maps</span></span> <span class="hidden" data-render-id="quarto-metasitename">Web Mapping and Geovisualisation</span> <span class="hidden" data-render-id="quarto-twittercarddesc"></span> <span class="hidden" data-render-id="quarto-ogcardddesc"></span></p>
</div>
</section>
</section>
</section>

</main> <!-- /main -->
<script id = "quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a  href="/labs/w01_refresher.html" class="pagination-link  aria-label="&lt;span class=&#39;chapter-number&#39;&gt;3&lt;/span&gt;  &lt;span class=&#39;chapter-title&#39;&gt;Python Refresher&lt;/span&gt;">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class='chapter-number'>3</span>  <span class='chapter-title'>Python Refresher</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a  href="/labs/w03_webArch.html" class="pagination-link" aria-label="&lt;span class=&#39;chapter-number&#39;&gt;5&lt;/span&gt;  &lt;span class=&#39;chapter-title&#39;&gt;Web Architectures and APIs&lt;/span&gt;">
        <span class="nav-page-text"><span class='chapter-number'>5</span>  <span class='chapter-title'>Web Architectures and APIs</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <div class='footer-contents'>Web Mapping and Geovisualisation by Gabriele Filomena and Elisabetta Pietrostefani.
</div>  
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <div class='footer-contents'>This book was built with <a href="https://quarto.org/">Quarto</a>.
</div>  
    </div>
  </div>
</footer>

</body>

</html>
